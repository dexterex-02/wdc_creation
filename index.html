<!DOCTYPE html>
<html>
<head>
    <title>Dog Breed Data Connector</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
    <script>
        (function () {
            // Define the Web Data Connector
            var myConnector = tableau.makeConnector();

            myConnector.init = function(initCallback) {
                tableau.authType = tableau.authTypeEnum.none;
                initCallback();
            };

            myConnector.getSchema = function(schemaCallback) {
                var cols = [{
                    id: "id",
                    dataType: tableau.dataTypeEnum.string
                }, {
                    id: "name",
                    dataType: tableau.dataTypeEnum.string
                }, {
                    id: "description",
                    dataType: tableau.dataTypeEnum.string
                }, {
                    id: "life_max",
                    dataType: tableau.dataTypeEnum.int
                }, {
                    id: "life_min",
                    dataType: tableau.dataTypeEnum.int
                }, {
                    id: "male_weight_max",
                    dataType: tableau.dataTypeEnum.int
                }, {
                    id: "male_weight_min",
                    dataType: tableau.dataTypeEnum.int
                }, {
                    id: "female_weight_max",
                    dataType: tableau.dataTypeEnum.int
                }, {
                    id: "female_weight_min",
                    dataType: tableau.dataTypeEnum.int
                }, {
                    id: "hypoallergenic",
                    dataType: tableau.dataTypeEnum.bool
                }];

                var schema = {
                    id: "dogBreeds",
                    alias: "Dog Breeds",
                    columns: cols
                };

                schemaCallback([schema]);
            };

            myConnector.getData = function(table, doneCallback) {
                var apiUrl = "https://dogapi.dog/api/v2/breeds";

                $.getJSON(apiUrl, function(response) {
                    var data = response.data;
                    var tableData = [];

                    for (var i = 0; i < data.length; i++) {
                        var attributes = data[i].attributes;

                        tableData.push({
                            "id": data[i].id,
                            "name": attributes.name,
                            "description": attributes.description,
                            "life_max": attributes.life.max,
                            "life_min": attributes.life.min,
                            "male_weight_max": attributes.male_weight.max,
                            "male_weight_min": attributes.male_weight.min,
                            "female_weight_max": attributes.female_weight.max,
                            "female_weight_min": attributes.female_weight.min,
                            "hypoallergenic": attributes.hypoallergenic
                        });
                    }

                    table.appendRows(tableData);
                    doneCallback();
                });
            };

            tableau.registerConnector(myConnector);

            // Trigger Tableau to connect to the Web Data Connector
            $(document).ready(function () {
                $("#submitButton").click(function () {
                    tableau.connectionName = "Dog Breeds Data";
                    tableau.submit();
                });
            });
        })();
    </script>
</head>
<body>
    <button id="submitButton">Connect to Dog Breeds Data</button>
</body>
</html>
